
import numpy as np
import logging

logger = logging.getLogger(__name__)

class KokoroDirect:
    def __init__(self, model_path: str, voices_path: str, use_tokenizer: bool = True):
        self.model_path = model_path
        self.voices_path = voices_path
        self.use_tokenizer = use_tokenizer
        self._load_model()
        
    def _load_model(self) -> None:
        """Load the ONNX model and tokenizer."""
        try:
            import kokoro_onnx
            import onnxruntime as ort
        except Exception as e:
            logger.error(f"Failed to load kokoro_onnx or onnxruntime: {e}", exc_info=True)
            raise

        # Load voices
        try:
            self.voices = np.load(self.voices_path)
            logger.debug(f"Loaded {len(self.voices)} voices")
        except Exception as e:
            logger.error(f"Failed to load voices: {e}", exc_info=True)
            raise

        # Cache directory for temp files
        self.cache_dir = None
